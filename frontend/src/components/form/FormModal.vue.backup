<template>
	<vxe-modal title="申請單明細" v-model="visible" width="80%" height="90%" :lock-scroll="false" esc-closable resize show-footer>
		<template #default>
			<el-form ref="form" size="small" :model="form" label-position="top">
				<el-row type="flex">
					<div class="flex-row mr-5">
						<label class="label">案件編號</label>
						<div class="text">{{form.PaymentID}}</div>
					</div>
					<div class="flex-row">
						<label class="label">管制編號</label>
						<el-form-item prop="ProjectID">
							<el-input maxlength="50" v-model="form.ProjectID" />
						</el-form-item>
					</div>
				</el-row>
				<table class="modal-table border">
					<tbody>
						<tr>
							<th style="width: 180px">1.工程名稱</th>
							<td colspan="7">
								<el-form-item prop="ProjectName">
									<el-input maxlength="50" v-model="form.ProjectName" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>2.工地地址或地號</th>
							<td colspan="3">
								<el-form-item prop="ProjectAddr">
									<el-input maxlength="50" v-model="form.ProjectAddr" />
								</el-form-item>
							</td>
							<th style="width: 180px">3.E-Mail</th>
							<td colspan="3">{{form.Email}} ({{form.IsVerify ? '已驗證' : '未驗證'}})</td>
						</tr>
						<tr>
							<th>4.建照字號或合約編號</th>
							<td colspan="3">
								<el-form-item prop="ContractID">
									<el-input maxlength="50" v-model="form.ContractID" />
								</el-form-item>
							</td>
							<th>5.工程類別代碼</th>
							<td colspan="3">
								<el-form-item prop="ContractID">
									<el-select style="width:100%" v-model="form.ProjectCode">
										<el-option label="請選擇" value></el-option>
										<el-option label="1. 建築（房屋）工程-鋼筋混凝土構造" value="1"></el-option>
										<el-option label="2. 建築（房屋）工程-鋼骨結構" value="2"></el-option>
										<el-option label="3. 建築（房屋）工程-拆除" value="3"></el-option>
										<el-option label="4. 道路（隧道）工程-道路" value="4"></el-option>
										<el-option label="5. 道路（隧道）工程-隧道" value="5"></el-option>
										<el-option label="6. 管線開挖工程" value="6"></el-option>
										<el-option label="7. 橋樑工程" value="7"></el-option>
										<el-option label="8. 區域開發工程-社區" value="8"></el-option>
										<el-option label="9. 區域開發工程-工業區" value="9"></el-option>
										<el-option label="A. 區域開發工程-遊樂區" value="A"></el-option>
										<el-option label="B. 疏濬工程" value="B"></el-option>
										<el-option label="Z. 其他工程" value="Z"></el-option>
									</el-select>
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>6.工程內容概述</th>
							<td colspan="7">
								<el-form-item prop="ProjectDescription">
									<el-input maxlength="100" v-model="form.ProjectDescription" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>7.營建業主名稱</th>
							<td colspan="3">
								<el-form-item prop="BizCompany">
									<el-input maxlength="50" v-model="form.BizCompany" />
								</el-form-item>
							</td>
							<th>8.營利事業統一編號</th>
							<td colspan="3">
								<el-form-item prop="BizID">
									<el-input type="number" maxlength="50" v-model="form.BizID" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>9.營業地址</th>
							<td colspan="7">
								<el-form-item prop="BizAddr1">
									<el-input maxlength="50" v-model="form.BizAddr1" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>10.聯絡地址</th>
							<td colspan="3">
								<el-form-item prop="BizAddr2">
									<el-input maxlength="50" v-model="form.BizAddr2" />
								</el-form-item>
							</td>
							<th>11.聯絡電話</th>
							<td colspan="3">
								<el-form-item prop="BizTel">
									<el-input type="number" maxlength="50" v-model="form.BizTel" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>12.負責人姓名</th>
							<td>
								<el-form-item prop="BizOwnerName">
									<el-input maxlength="50" v-model="form.BizOwnerName" />
								</el-form-item>
							</td>
							<th style="width: 80px">13.職稱</th>
							<td>
								<el-form-item prop="BizOwnerJobTitle">
									<el-input maxlength="50" v-model="form.BizOwnerJobTitle" />
								</el-form-item>
							</td>
							<th>14.身分證字號</th>
							<td colspan="3">
								<el-form-item prop="BizOwnerID">
									<el-input maxlength="10" v-model="form.BizOwnerID" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>15.聯絡人姓名</th>
							<td>
								<el-form-item prop="BizContactName">
									<el-input maxlength="50" v-model="form.BizContactName" />
								</el-form-item>
							</td>
							<th>16.職稱</th>
							<td>
								<el-form-item prop="BizContactJobTitle">
									<el-input maxlength="50" v-model="form.BizContactJobTitle" />
								</el-form-item>
							</td>
							<th>17.身分證字號</th>
							<td colspan="3">
								<el-form-item prop="BizContactID">
									<el-input maxlength="10" v-model="form.BizContactID" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>18.聯絡人地址</th>
							<td colspan="3">
								<el-form-item prop="BizContactAddr">
									<el-input maxlength="50" v-model="form.BizContactAddr" />
								</el-form-item>
							</td>
							<th>19.電話</th>
							<td colspan="3">
								<el-form-item prop="BizContactTel">
									<el-input type="number" maxlength="50" v-model="form.BizContactTel" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>20.承包(造)單位名稱</th>
							<td colspan="3">
								<el-form-item prop="ExecCompany">
									<el-input maxlength="50" v-model="form.ExecCompany" />
								</el-form-item>
							</td>
							<th>21.營利事業統一編號</th>
							<td colspan="3">
								<el-form-item prop="ExecID">
									<el-input type="number" maxlength="50" v-model="form.ExecID" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>22.營業地址</th>
							<td colspan="7">
								<el-form-item prop="ExecAddr1">
									<el-input maxlength="50" v-model="form.ExecAddr1" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>23.聯絡地址</th>
							<td colspan="3">
								<el-form-item prop="ExecAddr2">
									<el-input maxlength="50" v-model="form.ExecAddr2" />
								</el-form-item>
							</td>
							<th>24.聯絡電話</th>
							<td colspan="3">
								<el-form-item prop="ExecTel1">
									<el-input type="number" maxlength="50" v-model="form.ExecTel1" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>25.負責人姓名</th>
							<td>
								<el-form-item prop="ExecOwnerName">
									<el-input maxlength="50" v-model="form.ExecOwnerName" />
								</el-form-item>
							</td>
							<th>26.職稱</th>
							<td>
								<el-form-item prop="ExecOwnerJobTitle">
									<el-input maxlength="50" v-model="form.ExecOwnerJobTitle" />
								</el-form-item>
							</td>
							<th>27.身分證字號</th>
							<td colspan="3">
								<el-form-item prop="ExecOwnerID">
									<el-input maxlength="10" v-model="form.ExecOwnerID" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>28.工務所地址</th>
							<td colspan="3">
								<el-form-item prop="ExecAddr3">
									<el-input maxlength="50" v-model="form.ExecAddr3" />
								</el-form-item>
							</td>
							<th>29.電話</th>
							<td colspan="3">
								<el-form-item prop="ExecTel2">
									<el-input type="number" maxlength="50" v-model="form.ExecTel2" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>30.工地主任姓名</th>
							<td>
								<el-form-item prop="ExecManagerName">
									<el-input maxlength="50" v-model="form.ExecManagerName" />
								</el-form-item>
							</td>
							<th>31.電話</th>
							<td>
								<el-form-item prop="ExecManagerTel">
									<el-input type="number" maxlength="50" v-model="form.ExecManagerTel" />
								</el-form-item>
							</td>
							<th>32.工地環保負責人姓名</th>
							<td>
								<el-form-item prop="ExecEnvManagerName">
									<el-input maxlength="50" v-model="form.ExecEnvManagerName" />
								</el-form-item>
							</td>
							<th style="width: 80px">33.電話</th>
							<td>
								<el-form-item prop="ExecEnvMangerTel">
									<el-input type="number" maxlength="50" v-model="form.ExecEnvMangerTel" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>34.工程合約經費</th>
							<td colspan="7">
								<el-form-item prop="ContractMoney">
									<el-input type="number" v-model="form.ContractMoney" />
								</el-form-item>
							</td>
						</tr>
						<tr>
							<th>35.工程環保經費</th>
							<td colspan="7">
								<el-row type="flex">
									<div>
										<el-form-item prop="EnvMoney">
											<el-input type="number" v-model="form.EnvMoney" />
										</el-form-item>
									</div>
									<div class="pure-text">佔工程合約經費之</div>
									<div>
										<el-form-item prop="EnvMoneyPercent">
											<el-input type="number" v-model="form.EnvMoneyPercent" />
										</el-form-item>
									</div>
									<div class="pure-text">％</div>
								</el-row>
							</td>
						</tr>
						<tr>
							<th>36.工程面積</th>
							<td colspan="4">
								<el-radio v-model="form.Area1" :label="1">建築面積</el-radio>
								<el-radio v-model="form.Area1" :label="2">總樓地板面積</el-radio>
								<el-radio v-model="form.Area1" :label="3">施工面積</el-radio>
								<el-radio v-model="form.Area1" :label="4">隧道面積</el-radio>
								<el-radio v-model="form.Area1" :label="5">橋面面積</el-radio>
								<el-radio v-model="form.Area1" :label="6">開發面積</el-radio>
							</td>
							<td colspan="3">
								<el-row type="flex">
									<div>
										<el-form-item prop="Area2">
											<el-input type="number" v-model="form.Area2" />
										</el-form-item>
									</div>
									<div class="pure-text">
										<el-radio v-model="form.Area3" :label="1">
											M
											<sup>2</sup>
										</el-radio>
										<el-radio v-model="form.Area3" :label="2">公頃</el-radio>
									</div>
								</el-row>
							</td>
						</tr>
						<tr>
							<th>37.預計施工期程</th>
							<td colspan="7">
								<el-row type="flex">
									<div>
										<el-form-item prop="StartDate">
											<el-date-picker style="width:140px" v-model="form.StartDate" type="date" value-format="yyyy-MM-dd" placeholder="開始日期"></el-date-picker>
										</el-form-item>
									</div>
									<div class="pure-text">~</div>
									<div>
										<el-form-item prop="StartDate">
											<el-date-picker style="width:140px" v-model="form.EndDate" type="date" value-format="yyyy-MM-dd" placeholder="開始日期"></el-date-picker>
										</el-form-item>
									</div>
									<div class="pure-text">共 {{diffDays}} 日曆天</div>
								</el-row>
							</td>
						</tr>
						<tr>
							<th>38.是否繳交空氣污染防制書(嘉義市政府公共工程請繳交)</th>
							<td colspan="2">
								<el-radio v-model="form.HasPromiseDoc" :label="true">是</el-radio>
								<el-radio v-model="form.HasPromiseDoc" :label="false">否</el-radio>
							</td>
							<td colspan="5">
								<a :href="`api/Form/Download?f=${form.PromiseDoc}&n=${form.PromiseDocDisplayName}`" target="_blank">{{form.PromiseDocDisplayName}}</a>
							</td>
						</tr>
					</tbody>
				</table>
				<h2 class="modal-header">
					<i class="fa fa-paperclip"></i> 附件
				</h2>
				<ul class="file-list">
					<li v-for="(item, idx) in form.Attachments" :key="idx">
						<div style="width: 100%" class="flex-row-center">
							<span class="filename">
								<a :href="`api/Form/Download?f=${form.FileName}&n=${form.DisplayName}`" target="_blank">{{item.DisplayName}}</a>
							</span>
						</div>
					</li>
				</ul>
				<h2 class="modal-header">
					<i class="fa fa-paperclip"></i> 收據
				</h2>
			</el-form>
		</template>
		<template #footer>
			<el-button size="small" @click="visible = false">
				<i class="fa fa-ban"></i> 取 消
			</el-button>
			<el-button type="primary" size="small" @click="save()">
				<i class="fa fa-floppy-o"></i> 儲 存
			</el-button>
		</template>
	</vxe-modal>
</template>
<script>
import { mapGetters } from 'vuex';
import { dateTime } from '@/mixins/filter';
export default {
	name: 'FormModal',
	props: ['show', 'data'],
	mixins: [dateTime],
	data() {
		return {
			visible: false,
			loading: false,
			form: {}
		};
	},
	mounted() {},
	computed: {
		...mapGetters(['currentUser']),
		diffDays() {
			if (!this.form.StartDate || !this.form.EndDate) return 0;
			var day1 = new Date(this.form.StartDate);
			var day2 = new Date(this.form.EndDate);

			var difference = Math.abs(day2 - day1);
			var days = Math.round(difference / (1000 * 3600 * 24) + 1);
			return days;
		}
	},
	methods: {
		save() {}
	},
	watch: {
		show: {
			handler(newValue, oldValue) {
				this.visible = newValue;
				if (this.visible) {
					this.form = JSON.parse(JSON.stringify(this.data));
				}
			}
		},
		visible: {
			handler(newValue, oldValue) {
				this.$emit('update:show', newValue);
			}
		}
	}
};
</script>
<style lang="scss">
.flex-row {
	display: flex;
	.label {
		font-weight: 700;
		margin-right: 10px;
		line-height: 32px;
	}
	.text {
		line-height: 32px;
	}
}
.modal-table {
	width: 100%;
	border-collapse: collapse;
	&.border {
		th,
		td {
			border: 1px solid #ccc;
		}
	}
	th,
	td {
		padding: 11px 8px;
		vertical-align: top !important;
	}
	.pure-text {
		line-height: 33px;
		margin: 0 10px;
	}
}
.modal-header {
	margin: 10px 0;
}
.file-list {
	list-style-type: none;
	li {
		display: flex;
		border-bottom: 1px dashed #ccc;
		padding: 4px 0;
		.filename {
			display: block;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
	}
}
</style>